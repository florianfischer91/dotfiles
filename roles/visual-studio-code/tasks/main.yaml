---
# workaround because role can't handle the automatically generates vscode.sources and it would conflict with vscode.list
- name: Check if vscode.sources exists
  ansible.builtin.stat:
    path: /etc/apt/sources.list.d/vscode.sources
  register: vscode_sources

- name: Install
  vars:
    visual_studio_code_skip_add_repo: "{{ vscode_sources.stat.exists }}"
    users:
      - username: "{{ lookup('env', 'ANSIBLE_REMOTE_USER') | default(ansible_user, true) }}"
        visual_studio_code_extensions: "{{ vs_code_extensions }}"
        visual_studio_code_settings: {
          "editor.fontFamily": "CaskaydiaMono Nerd Font",
          "editor.tabSize": 2,
          "security.workspace.trust.untrustedFiles": "open",
          "editor.minimap.enabled": false,
          "git.ignoreMissingGitWarning": true,
          "editor.fontSize": 12,
          "editor.occurrencesHighlight": false,
          "editor.selectionHighlight": false,
          "editor.suggestOnTriggerCharacters": false,
          "editor.tabCompletion": "on",
          "editor.quickSuggestions": {
            "other": false,
            "comments": false,
            "strings": false
          },
          "files.trimTrailingWhitespace": true,
          "git.confirmSync": false,
          "window.menuBarVisibility": "compact",
          "git.autofetch": true,
          "git.openRepositoryInParentFolders": "always",
          "explorer.confirmDelete": false,
          "extensions.ignoreRecommendations": true,
          "workbench.colorTheme": "Tokyo Night",
          "window.titleBarStyle": "custom"
        }
  ansible.builtin.include_role:
    name: gantsign.visual-studio-code
